---
title: 'Anytime Lifelong Multi-Agent Pathfinding
in Topological Maps'
date: '2025-01-28'
tags: ['robotics', 'paper review']
---

### Abstract

본 연구는 새롭게 할당된 목표에 따라 지속적으로 온라인에서 다중 에이전트 경로 찾기(MAPF) 인스턴스를 해결하는 평생 다중 에이전트 경로 찾기(lifelong multi-agent path finding, lifelong MAPF) 문제를 다룹니다. 구체적으로, 위상 지도(topological map)에서의 lifelong MAPF에 초점을 맞춥니다. 이 문제는 에이전트의 이동이 전체 맵 영역이 아닌 위상 지도의 좁은 복도에 제한되기 때문에 까다롭습니다. 복도에서는 우회로가 제한적이거나 더 멀리 떨어져 있을 수 있어 경로 계산을 상당히 복잡하게 만듭니다. 게다가, 낮은 품질의 솔루션은 복도에서 교통 혼잡이나 심지어 교착 상태(deadlock)를 유발할 수 있습니다.

따라서, anytime 전략을 기반으로 복도 내 충돌을 효과적으로 해결하는 새로운 lifelong MAPF 방법을 제안합니다. 이 방법은 교통 혼잡이 심한 하위 경로(sub-paths)를 업데이트하여 솔루션 품질을 점진적으로 개선합니다. 또한, 충돌 기반 탐색(conflict-based search, CBS)에서 복도 충돌을 효과적으로 해결하기 위해 몇 가지 개선 단계를 채택합니다. 이 방법은 CBS의 탐색 공간과 계산 시간을 크게 줄여줍니다.

---

### Introduction

<img src="https://velog.velcdn.com/images/devjo/post/b19c6701-7fe1-4d33-b972-2d52ccf451de/image.png" alt="Example Image" style="display: block; margin: 0 auto; height:200;" />

자동화된 창고 시스템에서, 여러 대의 모바일 로봇은 지속적으로 들어오는 물류 작업들을 처리합니다. 모바일 로봇은 패키지나 재고 포드를 각각의 목표 위치로 운반하기 위해 창고 공간을 이동합니다. 모바일 로봇의 자율 주행을 위해, 로봇 관리 시스템은 모든 로봇에 대해 충돌 없는 경로를 지속적으로 계획해야 합니다. 이 문제는 '평생 다중 에이전트 경로 찾기(lifelong multi-agent path finding, lifelong MAPF)'로 알려져 있으며, 최근 많은 연구에서 다루고 있습니다.

대부분의 연구는 Kiva 시스템과 동일하게 그리드와 유사한 환경에서 lifelong MAPF 문제를 정의했습니다. 그러나 Kiva 시스템은 그리드 맵에서 많은 로봇을 체계적으로 운영하기 위해 마커 기반 위치 파악 및 Kiva 로봇을 위한 표준화된 공간과 같은 특수 설정을 필요로 합니다. 따라서 이 시스템을 일반적인 창고 공간이나 다양한 유형의 모바일 로봇에 적용하기는 어렵습니다. 이 문제를 해결하기 위해, 우리는 환경이 노드와 차선으로 구성된 그래프로 표현되는 위상 지도(topological map)에서의 lifelong MAPF 문제를 고려합니다. 또한, 위상 지도는 다양한 구조의 기존 창고 공간에 쉽게 적용될 수 있습니다.

그러나 위상 지도에서의 lifelong MAPF는 몇 가지 요인으로 인해 까다롭습니다. 첫째, 두 에이전트가 반대 방향으로 동시에 복도를 통과할 때 복도 충돌(corridor conflicts)이 자주 발생합니다. MAPF 알고리즘은 이 충돌을 해결하기 위해 불필요하게 많은 상태를 탐색하여 계산 시간을 상당히 증가시킵니다. 예를 들어, 충돌 기반 탐색(CBS)에서 복도 충돌은 복도 길이에 따라 탐색 공간을 기하급수적으로 증가시킵니다. 둘째, lifelong MAPF 방법은 빠른 온라인 계산을 위해 창 방식 접근(windowed approach) 및 준최적 해법(suboptimal solvers)과 같은 효율적인 알고리즘을 사용해야 합니다. 그러나 이러한 알고리즘은 일반적으로 낮은 품질의 솔루션을 생성하며, 우회로가 종종 위상 지도에 제한되어 있기 때문에 복도에서 교통 혼잡을 유발할 수 있습니다. 마지막으로, 준최적 해법은 때때로 막힌 복도(dead-end corridor)에서 교착 상태를 유발할 수 있습니다. 이를 피하기 위해, 알고리즘은 제한된 시간 내에 막힌 복도에 대한 최적의 진입 순서를 철저히 탐색해야 합니다.

본 연구에서는 위상 지도에서 복도 충돌을 효과적으로 해결하여 제한된 시간 내에 가능한 최상의 솔루션을 찾는 새로운 lifelong MAPF 방법을 제안합니다. 이 방법은 Anytime lifelong MAPF 알고리즘과 복도-CBS(Corridor-CBS) 알고리즘으로 구성됩니다.

---

### Related work

lifelong MAPF 문제와 one-shot MAPF 문제에 대한 선행 연구를 다루고 있으며 알고리즘은 최적성(optimality) 또는 완전성(completeness) 속성에 따라 분류될 수 있습니다. 최적 알고리즘은 항상 최적의 솔루션을 제공하지만, 에이전트 수에 대한 확장성은 제한적입니다. 반대로, 준최적 알고리즘은 솔루션 품질을 일부 양보하여 확장성을 개선하는 데 중점을 둡니다. 완전성은 솔루션이 존재할 경우 알고리즘이 결국 실행 가능한 솔루션을 찾는 속성입니다.

#### 1. Lifelong MAPF

Lifelong 방법은 빠른 온라인 계산을 위해 최적 해법 대신 효율적인 준최적 해법을 채택해야 합니다. 따라서 모든 lifelong 방법은 솔루션의 최적성을 보장하지는 않습니다. Ma et al은 에이전트에게 지속적으로 토큰을 전달하는 토큰 전달(token-passing) 방법을 제안했습니다. 토큰을 받은 에이전트는 작업을 할당하고 경로를 계획할 권한을 가집니다. 이 방법은 다른 에이전트의 경로를 동적 장애물로 간주하여 에이전트의 경로를 계산합니다. Liu et al는 새로운 목표를 가진 에이전트에 대해서만 경로를 계획했습니다. 그들은 교착 상태를 피하기 위해 격리된 주차 위치에 더미 경로(dummy paths)를 예약했습니다. Grenouilleau et al는 MAPF 해결사의 저수준 탐색을 위한 다중 레이블 A 알고리즘(multi-label A algorithm)을 제안했습니다. 이 알고리즘은 두 개의 연속적인 목표를 통과하는 경로를 결정하기 위해 원래의 A*를 확장합니다.

모든 경로가 아닌 몇몇 업데이트된 에이전트에 대한 하위 경로만 계획하기 때문에 일반적으로 낮은 품질의 솔루션을 제공합니다. 게다가, 이들은 각 에이전트가 다른 에이전트에 의해 차단되지 않는 격리된 목표 또는 주차 위치에서 쉴 수 있는 잘 형성된 맵(well-formed maps)에만 적용 가능합니다. Li et al은 이러한 문제를 해결하기 위해 RHCR(rolling-horizon collision resolution) 방법을 제안했습니다. 앞서 논의했듯이, RHCR은 제한된 시간 범위 내에서만 충돌을 해결함으로써 정기적인 시간 단계마다 모든 경로를 지속적으로 재계획합니다.

#### 2. MAPF SOLVER

Lifelong 알고리즘은 단일 MAPF 인스턴스를 해결하기 위해 MAPF 해결사를 지속적으로 호출합니다. MAPF 해결사는 에이전트의 시작 위치에서 목표 위치까지 충돌 없는 경로를 계획합니다. 일부 해결사는 규칙 기반(rule-based) 또는 우선순위 기반(prioritized) 방법을 적용했습니다.

규칙 기반 방법은 푸시 및 스왑과 같은 간단한 이동 규칙을 기반으로 다중 에이전트 경로를 계산합니다. 이는 다항식 시간 내에 솔루션 결정을 보장하지만, 솔루션 품질은 상대적으로 낮습니다. 우선순위 기반 방법은 미리 정해진 에이전트의 우선순위에 따라 각 에이전트에 대한 단일 경로를 순차적으로 계획합니다. 이는 솔루션의 완전성과 최적성을 보장하지는 않지만, 빠르고 확장성이 뛰어납니다.

Sartoretti et al는 PRIMAL이라는 학습 기반 MAPF 프레임워크를 제안했습니다. PRIMAL은 강화 학습 및 모방 학습을 통해 부분적으로 관찰 가능한 맵에서 단일 에이전트 정책을 훈련합니다. Sharon et al은 완전하고 최적의 솔루션을 얻기 위해 CBS(conflict-based search) 알고리즘을 제시했습니다. CBS는 충돌이 없는 노드를 결정할 때까지 이진 제약 트리(binary constraint tree)를 확장하여 두 에이전트 간의 충돌을 반복적으로 해결합니다.

#### 3. MAPF ON TOPOLOGICAL MAPS

많은 연구가 그리드 맵에서 MAPF 문제를 해결했지만, 위상 지도를 고려한 연구는 거의 없습니다. Liu et al은 섹터 기반 위상 그래프를 구축하고 각 섹터에 대한 교통 상황을 추정했습니다. 그들은 교통 혼잡을 피하기 위해 교통 상황을 고려하여 다중 에이전트 경로를 계획했습니다. Cohen et al은 고속도로에 대한 추가적인 휴리스틱 정보를 고려하고 에이전트가 복도에서 충돌을 피하도록 안내함으로써 CBS를 확장했습니다.

Binder et al은 위상 지도에서 4가지 대표적인 충돌 사례(순차적, 대기, 회피, 푸시)를 정의하고 각 사례에 대한 해결 방법을 제시했습니다. Li et al 또한 수많은 기차의 철도 스케줄링을 위해 위상 그래프에서의 MAPF를 고려했습니다. 그들은 수천 명의 에이전트에 대한 경로를 효율적으로 계획하기 위해 대규모 이웃 탐색(large neighborhood search)이라고 불리는 언제든지 전략을 사용하여 4개의 MAPF 인스턴스를 병렬로 해결했습니다.

---

### Problem formulation

<img src="https://velog.velcdn.com/images/devjo/post/e38f7dad-cd72-42a4-bed3-3c5ffe4a6bda/image.png" alt="Example Image" style="display: block; margin: 0 auto; height:200;" />

본 연구에서 고려하는 문제는 위상 지도(topological map)에서의 lifelong MAPF입니다. 위상 지도는 무방향 그래프 $G_M = (V_M, E_M)$으로 정의되며 정점 $v \in V_M$은 2D 공간의 위치를, 모서리 $e \in E_M$은 두 정점을 연결하는 차선(lane)을 나타냅니다.

에이전트는 일반적으로 좁은 복도로만 구성된 창고 환경에서 이동합니다. 복도 내의 정점은 에이전트가 따르거나 기다리는 중간 지점(waypoint)을 나타냅니다. MAPF 인스턴스는 위상 지도 $G_M$과 에이전트 집합 $A = {a_1, \ldots, a_N}$을 포함하며 각 에이전트는 고유한 시작점과 목표점을 가집니다. 두 경로 $p_i$, $p_j$ 사이의 충돌은 같은 시간에 같은 정점으로 이동하거나 같은 모서리를 반대 방향으로 통과할 때 발생합니다. 따라서 One-shot MAPF의 목적은 모든 에이전트에 대해 최소 총 비용 즉, $cost(P)=\sum_{p_i \in P} t_i$를 갖는 충돌 없는 경로 집합을 찾는 것입니다.

Lifelong MAPF 문제는 원샷 MAPF 문제의 온라인 버전으로, 에이전트가 현재 작업을 완료하면 새로운 작업을 지속적으로 할당합니다. 에이전트 집합 $A = {a_1, \ldots, a_N}$과 작업 집합 $T = {\tau_1, \ldots, \tau_K}$이 주어졌을 때, 목표는 처리량(throughput, 시간 단계당 완료된 평균 작업 수)을 최대화하여 A의 에이전트들이 T의 모든 작업을 완료하도록 하는 것입니다. 사이클 시간(cycle time)(작업당 평균 완료 시간)은 처리량과 역의 관계에 있으므로, 목표는 사이클 시간을 최소화하는 것과 같습니다.

---

### Anytime lifelong MAPF

<img src="https://velog.velcdn.com/images/devjo/post/036ff84e-c655-429d-b3cb-2472a6fb5ae6/image.png" alt="Example Image" style="display: block; margin: 0 auto; height:200;" />

lifelong MAPF 문제를 해결하기 위해, 우리는 가장 효율적인 방법 중 하나인 RHCR(rolling-horizon collision resolution) 접근법을 사용했습니다. 다중 에이전트 경로가 새롭게 할당된 작업에 따라 지속적으로 업데이트되기 때문에, RHCR은 먼 미래의 계획을 무시합니다.

이는 오직 $ω$ 시간 단계의 제한된 시간 범위 내에서만 충돌을 해결함으로써 정기적인 $\lambda$ 시간 단계마다 다중 에이전트 경로를 반복적으로 계획합니다. 또한, RHCR은 단일 목표가 아닌 일련의 목표를 방문하는 경로를 계산합니다. 모든 목표를 방문하는 최단 경로의 거리가 $ω$보다 작으면, 새로운 작업의 목표가 시퀀스에 추가됩니다. 이 접근법은 전체 시간 범위를 고려하는 방법들보다 계산 시간을 줄이면서도 고품질의 솔루션을 생성합니다.

$ω$ 값이 작은 RHCR은 장거리 복도에서 교착 상태를 유발할 수 있습니다. 또한, 복도 충돌을 해결하기 위해 한 에이전트는 반대 방향으로 움직이는 다른 에이전트가 완전히 통과할 때까지 기다려야 합니다. 이 대기 시간은 길 수 있으며, 낮은 품질의 계획으로 인해 예상치 않게 누적될 수 있습니다.

위의 그림에서 보듯이 RHCR은 복도 길이보다 짧은 제한된 시간 범위를 사용할 때 복도 충돌을 감지하지 못할 때가 있습니다. 결국, RHCR은 두 에이전트가 다른 방향에서 동시에 복도에 진입하도록 경로를 계획합니다. 그러면 에이전트는 들어온 길을 되돌아가야 합니다. 이러한 상황이 여러 번 발생하면, 여러 에이전트가 복도에 갇히는 교통 혼잡이 발생합니다. 이 문제를 해결하는 방향으로 RHCR은 더 큰 시간 범위를 사용합니다. 그러나 큰 시간 범위로 모든 경로를 계획하려면 상당한 계산이 필요합니다.

본 논문에서 제안된 lifelong MAPF 알고리즘을 Anytime-RHCR이라고 부릅니다. 이 알고리즘은 에이전트들이 $\lambda$ 시간 단계를 이동한 후 경로를 반복적으로 계획하고, 에이전트가 현재 작업을 완료할 때마다 새로운 작업을 할당합니다. 경로 계획을 위해, Anytime-RHCR은 먼저 짧은 시간 범위 $ω_{init}$를 가진 빠른 준최적 해결사 ECBS를 사용하여 초기 솔루션을 얻습니다. 그런 다음 수정 집합(modification set)이라고 불리는 에이전트의 하위 집합을 결정합니다.

#### 1. Anytime-RHCR

이 알고리즘은 현재 작업을 완료한 에이전트에게 미완료된 작업을 지속적으로 할당합니다. 또한, 정기적인 $\lambda$ 시간 단계마다 할당된 작업을 실행하기 위해 모든 에이전트의 경로를 반복적으로 계획합니다. 이 알고리즘은 작은 창(window) $ω_{init}$로 초기 경로를 빠르게 찾은 다음, 확장된 창 $ω_{extd}$로 수정 집합의 하위 경로(subpaths)를 반복적으로 정제합니다. 수정 집합은 $ω_{extd}$에서의 추가 충돌과 관련된 에이전트로 결정됩니다.

각 작업 집합 $T'_i$는 $a_i$가 작업을 완료할 때마다 새로운 작업 $\tau_k \in T$를 추가하여 지속적으로 업데이트합니다. 업데이트된 새로운 작업은 집합에서 제거됩니다.

#### 2. Selection of the modification set

에이전트 집합 $A_M$ 결정하는 것은 솔루션의 품질에 영향을 미치는 중요한 구성 요소입니다. 제안된 방법은 먼저 충돌과 관련된 에이전트 집합을 선택하여 CF의 충돌을 해결하려고 시도합니다.

충돌이 존재할 경우, 우리는 CF에서 많은 충돌을 효과적으로 해결하는 에이전트 집합을 선택합니다. $G_{CF} = (V_{CF}, E_{CF})$를 충돌 그래프라고 하자. 여기서 각 정점 $v \in V_{CF}$는 에이전트이고 각 모서리 $e \in E_{CF}$는 두 에이전트 간의 충돌 관계를 나타냅니다. 제안된 방법은 $G_{CF}$에서 가장 큰 연결된 구성 요소(connected component) $V'{CF} \subset V{CF}$를 결정합니다.

$|V'_{CF}| > N_M$이면 연결된 에이전트를 무작위로 선택하여 에이전트 집합 $A_M$을 결정합니다. 반대의 경우에는 에이전트 집합을 $V'_{CF}$의 모든 에이전트 집합으로 초기화됩니다. 그런 다음 무작위 에이전트 $a_i$을 선택하고 경로 $p_i$를 차단하는 다른 에이전트를 추가합니다. 이는 $|A_M|=N_M$이 될 때까지 반복됩니다.

충돌이 없을 경우, 우리는 에이전트 기반 선택 방법(agent-based selection method)을 적용하는데 이는 가장 큰 지연(delay)를 가진 에이전트 $a_i$를 결정하고 에이전트 집합에 삽입합니다. 지연에 대한 계산은 최단 경로와 계획된 경로 사이 비용 차이로 정의됩니다.

#### 3. Windowed MAPF Solvers

제한된 시간 범위 충돌 검사(bounded horizon collision checks)를 사용하여 다중 에이전트 경로 P를 계산하기 위한 창 방식 MAPF 해결사(windowed MAPF solver)을 고안합니다. $P$의 처음 $ω$ 시간 단계까지만 충돌을 검사하고 해결하며, 나머지 시간 단계의 충돌은 무시합니다. 따라서 $ω$ 시간 단계 이후, 해결사는 충돌에 관계없이 에이전트 목표에 대한 최단 경로를 결정합니다.

본 논문에서는 저수준 탐색을 위해 SIPP 방법(safe interval path planning, SIPP)을 가진 다중 레이블 A 알고리즘(multi-label A algorithm)을 사용합니다.

---

### Conclusion

본 논문에서는 위상 맵에서의 lifelong MAPF를 위한 RHCR 방법을 기반으로 한 새로운 알고리즘을 제시합니다. 일반적으로, 두 에이전트 간의 충돌은 한 에이전트가 옆으로 이동하게 함으로써 쉽게 해결될 수 있습니다. 그러나 위상 맵에서는 복도 내에서 옆으로 이동할 수 없습니다. 따라서 작은 제한된 시간 범위를 가진 RHCR은 교통 혼잡을 유발합니다.

제안된 접근법은 우회로가 제한적이고 교통 혼잡이 심한 위상 맵에서 고품질 솔루션을 얻을 수 있었고, Corridor-CBS라는 MAPF 해결사를 제시했습니다. 이는 충돌을 효과적으로 해결하기 위해 여러 개선 사항을 적용하여 CBS의 실행 시간을 크게 줄였습니다.

제안된 방법이 lifelong MAPF 실험에서 뛰어난 결과를 달성했지만, 그 성능은 초기 솔루션의 품질에 따라 달라집니다. 향후 연구에서는 lifelong MAPF와 다중 에이전트 작업 할당(multi-agent task assignments)의 통합 문제를 연구할 것이며 혼잡 정도에 따라 준최적성 계수와 시간 범위를 적응적으로 결정하는 방법을 고려할 수 있다고 제시합니다.

---

### 참고 자료

[원본 경로 #1](https://ieeexplore.ieee.org/stamp/stamp.jsp?arnumber=10054055)



