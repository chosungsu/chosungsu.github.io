---
title: 'Transportation and Assignment Problems Ⅱ'
date: '2024-07-22'
tags: ['Operations Research 1', 'lecture']
---

### loop and loop pivoting

#### loop

루프란 아래 3가지 조건을 모두 만족하는 최소 4개의 서로 다른 셀로 구성된 순서화된 시퀀스입니다.

1. 두 개의 연속된 셀이 같은 행이나 열에 있어야 한다.

2. 세 개 이상의 연속된 셀이 같은 행이나 열에 있어서는 안된다.

3. 마지막 셀이 첫번쨰 셀과 같은 행이나 열에 있어야 한다.

루프는 닫힌 경로로 생각할 수 있습니다.

<img src="https://velog.velcdn.com/images/devjo/post/a7e60fcb-a16f-4728-a880-9ace5314946f/image.png" style="display: block; margin: 0 auto; height:200;" />

위 이미지를 보면 두 연속된 셀은 같은 행이나 열에 있으므로 1번 조건을 충족합니다. 세 개 이상 연속된 셀은 없으므로 2번 조건도 충족합니다. 첫번째 셀과 마지막 셀은 같은 열에 존재하므로 3번 조건도 충족합니다.

#### loop pivoting

우선 entering variable을 정합니다. 입력 변수에서 시작하여 일부 BV를 포함하는 루프를 찾습니다. 루프는 하나뿐이기 때문에 모든 BV를 고려할 필요는 없습니다. 루프에 있는 셀을 세고 홀수인지 짝수인지 라벨을 붙입니다. entering variable은 0으로 표시합니다. 모든 홀수 셀 중에서 가장 작은 값을 찾습니다. 그 값을 $\theta$라고 하고 leaving variable이 됩니다. 루프의 각 홀수 셀을 $\theta$만큼 감소시키고 각 짝수 셀을 $\theta$만큼 증가시킵니다.

예를 들어 첫번째 행의 총 공급량 35이고 두번째 행의 총 공급량 50, 세번째 행의 총 공급량 40이 있고 첫번째 열의 총 수요량 45, 두번째 열의 총 수요량 20, 세번째 열의 총 수요량 30, 네번째 열의 총 수요량 30로 되어있는 tableau가 있다고 합시다. 각 셀의 단위 운송 비용은 $\begin{bmatrix} 8 & 6 & 10 & 9 \\ 9 & 12 & 13 & 7 \\ 14 & 9 & 16 & 3 \end{bmatrix}$ 이라고 합시다. 그리고 BV의 값은 $\begin{bmatrix} 35 & 0 & 0 & 0 \\ 10 & 20 & 20 & 0 \\ 0 & 0 & 10 & 30 \end{bmatrix}$으로 이전에 구한 적이 있습니다.

다만 pivoting 과정에서는 비용 정보와 공급/수요 정보가 실제로 필요하지 않으므로 지우고 풀이해도 됩니다. 하나의 entering variable을 정한 다음에는 BV를 나타내는 구간(이전 과정에서 구했던 BFS에서 금액이 할당된 구간)까지 이동합니다. 이렇듯 할당된 구간까지 루프로 이어갑니다. 만약 동일한 행 또는 열에 세 개 이상의 연속된 셀이 존재한다면 중간을 건너뛰고 마지막 셀에 연결합니다. 이렇게 될 때 예시에서는 $\begin{bmatrix} 0 & 1 & 2 & 3 & 4 & 5 & 0 \end{bmatrix}$의 루프가 생성되어 홀수 셀은 녹색, 짝수 셀은 빨간색으로 표시를 해줍니다. 홀수 셀 중에서 가장 작은 할당 값은 20으로 이를 더하거나 빼는 작업을 실행합니다. 해당 셀은 이제 0으로서 출발점이 됩니다.

---

### transportation simplex method

우선 문제의 균형을 맞춥니다. northwest corner, minimum cost, vogel 이렇게 3가지 방법 중 하나를 사용하여 초기 BFS를 찾습니다. 각 공급 지점에 대해 보조 변수 $u_i$를 도입하고 각 수요 지점에 대해 보조 변수 $v_i$를 도입합니다. 모든 BV에 대해 $u_1=0$과 $u_i+v_j=c_{ij}$를 사용하여 비용계수($c_{ij}$)를 업데이트합니다. 모든 NBV에 대해 $w_{ij}=u_i+v_j-c_{ij}$를 계산합니다. 모든 $w_{ij} \le 0$이면 현재 BFS가 최적입니다. 그렇지 않은 경우에는 해당 값이 가장 큰 변수를 entering variable로 선택합니다. loop pivot을 사용해서 새 BFS를 얻고 3단계로 이동합니다.

위와 동일한 transportation problem에서 행이 3개, 열이 4개이므로 $u$, $v$를 3개 추가합니다.

$u_1=0, u_1+v_1=8 \rightarrow v_1 = 8$

$u_2+v_1=9 \rightarrow u_2 = 1$

$u_2+v_2=12 \rightarrow v_2 = 11$

$u_2+v_3=13 \rightarrow v_3 = 12$

$u_3+v_3=16 \rightarrow u_3 = 4$

$u_3+v_4=5 \rightarrow v_4 = 1$

이렇게 모든 BV를 업데이트 하였고 이제 NBV를 계산하도록 합니다.

$w_{12}=u_1+v_2-c_{12} \rightarrow 5$

$w_{13}=u_1+v_3-c_{13} \rightarrow 2$

$w_{14}=u_1+v_4-c_{14} \rightarrow -8$

$w_{24}=u_2+v_4-c_{24} \rightarrow -5$

$w_{31}=u_3+v_1-c_{31} \rightarrow -2$

$w_{32}=u_3+v_2-c_{32} \rightarrow 6$

만약 $w_{ij}$가 모두 음수이면 최적화 상태이지만 현재로는 그렇지 않으므로 가장 큰 값인 6이 있는 셀이 entering variable이 됩니다. 이 값을 기준으로 pivoting을 진행합니다.

루프는 단 한 개이며 $\begin{bmatrix} 0 & 1 & 2 & 3 & 0 \end{bmatrix}$의 루프가 생성됩니다. 이 중 홀수 셀은 녹색, 짝수 셀은 빨간색으로 표시를 해줍니다. 홀수 셀 중에서 가장 작은 할당 값은 10으로 이를 더하거나 빼는 작업을 실행합니다. 해당 셀은 이제 0으로서 출발점이 됩니다. 변경된 BV의 값은 $\begin{bmatrix} 35 & 0 & 0 & 0 \\ 10 & 10 & 30 & 0 \\ 0 & 10 & 0 & 30 \end{bmatrix}$이고 u와 v를 다시 업데이트합니다.

$u_1=0, u_1+v_1=8 \rightarrow v_1 = 8$

$u_2+v_1=9 \rightarrow u_2 = 1$

$u_2+v_2=12 \rightarrow v_2 = 11$

$u_2+v_3=13 \rightarrow v_3 = 12$

$u_3+v_2=9 \rightarrow u_3 = -2$

$u_3+v_4=5 \rightarrow v_4 = 7$

이렇게 모든 BV를 업데이트 하였고 이제 NBV를 계산하도록 합니다.

$w_{12}=u_1+v_2-c_{12} \rightarrow 5$

$w_{13}=u_1+v_3-c_{13} \rightarrow 2$

$w_{14}=u_1+v_4-c_{14} \rightarrow -2$

$w_{24}=u_2+v_4-c_{24} \rightarrow 1$

$w_{31}=u_3+v_1-c_{31} \rightarrow -8$

$w_{33}=u_3+v_3-c_{33} \rightarrow -6$

$w_{ij}$가 모두 음수이면 최적화 상태이지만 현재로는 그렇지 않으므로 가장 큰 값인 5가 있는 셀이 entering variable이 됩니다. 이 값을 기준으로 pivoting을 진행합니다. 이와 같은 과정을 반복한 결과 최적해는 BV가 $x_{12}=10, x_{13}=25, x_{21}=45, x_{23}=5, x_{32}=10, x_{34}=30$을 갖고 $z^*=6*10+10*25+9*45+13*5+9*10+5*30=1020$을 갖습니다.

---

### transshipment problem

일반적인 transportation problem에서는 제품이 공급 지점에서 수요 지점으로 직접 운송됩니다. 실제 상황에서는 그 이동 경로 상에 몇 개의 환적 지점(transshipment points)가 있을 수 있고 환적 문제를 운송 문제로 바꾸어 풀이하여 솔루션을 찾을 수 있습니다.

그러기 위해서는 환적 지점을 무시하고 원래의 운송 문제를 구성해야 하고 각 환적 지점에 대해 tableau에 행과 열을 추가하여 공급과 수요를 모두 원래 공급량과 같게 설정합니다.

예를 들어 공장 1은 최대 150개의 제품을, 공장 2는 최대 200개의 제품을 생산할 수 있다고 합시다. 제품은 고객 1과 고객 2에게 배송되며 각 고객은 최소 130개의 제품을 요구합니다. 또한 환적 지점은 2개가 있으며 이 곳을 들르면 더 저렴할 수 있다고 합니다.

|  | $T_1$ | $T_2$ | $C_1$ | $C_2$ |
|----------|---------|----------|---------|----------|
| $F_1$ | 8 | 13 | 25 | 28 |
| $F_2$ | 15 | 12 | 26 | 25 |
| $T_1$ | 0 | 6 | 16 | 17 |
| $T_2$ | 6 | 0 | 14 | 16 |

이와 같은 tableau가 있다고 한다면 $F_1$에서 $C_1$로 바로 이동하는 비용은 $25$이지만 중간에 $T_1$을 거쳐 $C_1$으로 이동한다면 $8+16=24$가 되어 더 저렴할 수 있음을 알 수 있습니다. 이러한 문제를 최적화하기 위해서는 환적 지점을 무시하고 두 공장과 두 고객에 대한 tableau를 제작해야 합니다.

|  | $C_1$ | $C_2$ |
|----------|---------|----------|
| $F_1$ | 25 | 28 |
| $F_2$ | 26 | 25 |

우선 문제를 공급과 수요의 균형을 확인하면 $350 \ne 260$으로 균형적이지 않기 때문에 90 정도의 수요를 갖는 dummy variable이 추가되도록 합니다.

|  | $C_1$ | $C_2$ | $d_1$ |
|----------|---------|----------|----------|
| $F_1$ | 25 | 28 | 0 |
| $F_2$ | 26 | 25 | 0 |

이제 환적 지점에 대해서 행과 열을 추가시키고 공급과 수요는 동일하게 350을 갖도록 tableau를 수정합니다.

|  | $T_1$ | $T_2$ | $C_1$ | $C_2$ | $d_1$ |
|----------|---------|----------|---------|----------|----------|
| $F_1$ | 8 | 13 | 25 | 28 | 0 |
| $F_2$ | 15 | 12 | 26 | 25 | 0 |
| $T_1$ | 0 | 6 | 16 | 17 | 0 |
| $T_2$ | 6 | 0 | 14 | 16 | 0 |

---

### assignment problem & hungarian method

#### assignment problem

한 회사에서 직원 4명을 4개 도시로 이전하는 문제가 있을 때 각 직원은 단 하나의 도시로만 전근되어야 합니다.

|  | $C_1$ | $C_2$ | $C_3$ | $C_4$ |
|----------|---------|----------|---------|----------|
| $E_1$ | 14 | 5 | 8 | 7 |
| $E_2$ | 2 | 12 | 6 | 5 |
| $E_1$ | 7 | 8 | 3 | 9 |
| $E_2$ | 2 | 4 | 6 | 10 |

이 문제에서 결정 변수는 $x_{ij}= \begin{cases} 1 \\ 0 \end{cases}$ 로 직원 $i$가 도시 $j$로 이전한 경우를 1, 그렇지 않은 경우를 0으로 합니다. 목적 함수는 min $z = 14x_{11}+5x_{12}+8x_{13}+7x_{14}+2x_{11}+12x_{12}+6x_{13}+5x_{14}+7x_{11}+8x_{12}+3x_{13}+9x_{14}+2x_{11}+4x_{12}+6x_{13}+10x_{14}$가 되고 제약조건은 $x_{11}+x_{12}+x_{13}+x_{14}=1$, $x_{21}+x_{22}+x_{23}+x_{24}=1$, $x_{31}+x_{32}+x_{33}+x_{34}=1$, $x_{41}+x_{42}+x_{43}+x_{44}=1$, $x_{11}+x_{21}+x_{31}+x_{41}=1$, $x_{12}+x_{22}+x_{32}+x_{42}=1$, $x_{13}+x_{23}+x_{33}+x_{43}=1$, $x_{14}+x_{24}+x_{34}+x_{44}=1$이 있습니다.

#### hungarian method

기본적인 simplex method가 퇴행되어 새로운 transportation method를 제안합니다. 이는 행과 열의 수가 $m$으로 동일하며 각 행의 최소 비용을 찾아 각 비용에서 해당 비용을 뺍니다. 새로운 행렬에서 각 열의 최소 비용을 찾아 각 비용에서 해당 비용을 뺍니다. 다음으로 모든 0을 덮을 수 있는 최소 개수의 행 또는 열로 줄을 그립니다. 이 줄의 개수가 $m$이면 덮인 0들 중에서 최적의 솔루션을 찾을 수 있습니다. $m$보다 작다면 다음 단계로 넘어갑니다. 다음으로는 직전 단계에서 그린 선으로 덮이지 않은 0이 아닌 가장 작은 원소를 찾습니다. 이 원소를 $k$라고 할 때 덮이지 않은 각 요소에서 $k$를 빼고 두 선으로 덮인 각 요소에 $k$를 더합니다. 이후 다시 직전 단계로 넘어가서 판단합니다.

위의 tableau를 사용하여 진행하면 우선 첫번쨰 행은 5, 두번쨰 행은 2, 세번째 행은 3, 네번째 행은 2가 최소값이고 이를 빼게 되면 아래와 같습니다.

|  | $C_1$ | $C_2$ | $C_3$ | $C_4$ |
|----------|---------|----------|---------|----------|
| $E_1$ | 9 | 0 | 3 | 2 |
| $E_2$ | 0 | 10 | 4 | 3 |
| $E_1$ | 4 | 5 | 0 | 6 |
| $E_2$ | 0 | 2 | 4 | 8 |

여기서 첫번째 열은 0, 두번째 열은 0, 세번째 열은 0, 네번째 열은 2가 최소값이고 마찬가지로 이를 빼게 되면 아래와 같습니다.

|  | $C_1$ | $C_2$ | $C_3$ | $C_4$ |
|----------|---------|----------|---------|----------|
| $E_1$ | 9 | 0 | 3 | 0 |
| $E_2$ | 0 | 10 | 4 | 1 |
| $E_1$ | 4 | 5 | 0 | 4 |
| $E_2$ | 0 | 2 | 4 | 6 |

이제 모든 0을 덮을 수 있는 라인은 첫번째 행과 첫번째 열 그리고 세번째 행 또는 열 중 행으로 선택하여 그립니다. 하지만 $m$보다 작은 3개의 라인이 그려졌으므로 다음 단계로 넘어가 선에 포함되지 않은 0이 아닌 가장 작은 수 $k=1$을 사용하여 덮이지 않은 곳은 빼고 두 선으로 덮인 곳은 더하여 다시 나타내겠습니다.

|  | $C_1$ | $C_2$ | $C_3$ | $C_4$ |
|----------|---------|----------|---------|----------|
| $E_1$ | 10 | 0 | 3 | 0 |
| $E_2$ | 0 | 9 | 3 | 0 |
| $E_1$ | 5 | 5 | 0 | 4 |
| $E_2$ | 0 | 1 | 3 | 5 |

직전 단계를 반복하면 첫번째 행, 첫번째 열, 네번째 열, 세번째 행 또는 열 중 행으로 선택하여 그리면 $m$과 같은 4개의 라인이 그려지게 되어 최적의 솔루션이 되었고 덮인 0 중에서 사용 가능합니다. 0을 모두 1로 바꾸고 나머지는 지우고 제약 조건에 부합하게 수정하면,

|  | $C_1$ | $C_2$ | $C_3$ | $C_4$ |
|----------|---------|----------|---------|----------|
| $E_1$ |  | 1 |  | 1 |
| $E_2$ | 1 |  |  | 1 |
| $E_1$ |  |  | 1 |  |
| $E_2$ | 1 |  |  |  |

여기서 $x_{12}=1$, $x_{33}=1$은 제약조건에 부합하므로 1을 그대로 두고 행 조건에 맞게 $x_{14}=0$으로 하면 자연적으로 $x_{24}=1$, $x_{21}=0$, $x_{41}=1$로 남게 됩니다.

|  | $C_1$ | $C_2$ | $C_3$ | $C_4$ |
|----------|---------|----------|---------|----------|
| $E_1$ |  | 1 |  | 0 |
| $E_2$ | 0 |  |  | 1 |
| $E_1$ |  |  | 1 |  |
| $E_2$ | 1 |  |  |  |

즉 최적해 값은 15입니다.

---

### 참고 자료

[원본 경로 #1](https://youtu.be/JdYD2EyCs04?si=el-IXcVOZ5WcPyH4)

[원본 경로 #2](https://youtu.be/tZ0cfYuSIuk?si=rCU7brEKSDonyQSs)

[원본 경로 #3](https://youtu.be/Ce_0SwpU1V4?si=29V10rz5GK6z5gQ1)

[원본 경로 #4](https://youtu.be/ltgSRxlUoWw?si=RnSKznV44wV9MHI-)


