---
title: 'Duality theory'
date: '2024-07-15'
tags: ['Operations Research 1', 'lecture']
---

### sensitivity analysis

민감도 분석을 사용하여 두 가지 유형의 질문에 답합니다.

question #1: 사용 가능한 리소스의 변화가 최적의 솔루션에 어떤 영향을 미치는가?

-사용 가능한 리소스는 제약 조건의 오른쪽에 표시됩니다.

question #2: 단위 이익이나 단위 비용의 변화가 최적 솔루션에 어떤 영향을 미치는가?

-단위 이익이나 단위 비용은 목적 함수의 계수로 표현됩니다.

예시로,

$$
max \\
z = 300x_1 + 200x_2 \\
s.t \\ 
2x_1+x_2 \le 8 \\
x_1+2x_2 \le 8 \\
x_1, x_2 \ge 0
$$

와 같은 LP 문제가 있었고 제약 조건 1을 $2x_1+x_2 \le 9$로 변경한다면 $M_1$의 shadow price는 변화된 $z(z_b)$, 이전 $z(z_a)$를 사용해서 다음과 같이 정의됩니다.

$$
\frac{z_b-z_a}{M_1 change} \\
= \frac{4400/3-4000/3}{9-8} \\
= 133
$$

즉 $M_1$을 1시간 가동하면 133달러가 증가한다는 의미입니다. 이와 동일하게 $M_2$도 적용하면, 

$$
\frac{z_c-z_a}{M_2 change} \\
= \frac{4100/3-4000/3}{9-8} \\
= 33
$$

33달러가 증가하게 되는데 두 기계의 용량을 모두 늘릴 수 있다면 어느 기계가 우선시되어야 하는가라는 질문에 $M_1$이라는 답을 할 수 있게 됩니다.

이제 목적 함수 계수에 대한 민감도 분석을 진행한다면,

$$
max \\
z = c_1x_1 + c_2x_2
$$

여기서 기울기인 $-\frac{c_1}{c_2}$는 $-\frac{2}{1} \le -\frac{c_1}{c_2} \le -\frac{1}{2} \rightarrow \frac{1}{2} \le \frac{c_1}{c_2} \le \frac{2}{1}$ 과 같은 범위임을 구할 수 있으며 이에 따라 제품의 판매 가격을 350, 250으로 변경한다면 솔루션의 변화가 생기는가라는 질문에 변화가 생기지는 않는다고 답을 할 수 있습니다.

---

### relations between primal and dual problems

$$
max \\
z = 30x_1 + 100x_2 \\
s.t \\ 
x_1+x_2 \le 7 \\
4x_1+10x_2 \le 40 \\
x_1 \ge 3 \\
x_1 \ge 0 \\
x_2 \ge 0
$$

예를 들어 위와 같은 LP 문제가 있을 때, simplex method 대신에 최적해 $z^*$의 하한과 상한을 찾고자 합니다. 모든 feasible 솔루션은 하한값이고 예를 들어 좌표가 $(5,2)$라면 $z=350 \le z^*$로 결과를 얻을 수 있습니다.

구하는 과정은 우선 모든 부등식이 곱셈 후 $\le$가 되도록 $u_i$의 부호를 선택해야 합니다. 다음으로 얻게 된 모든 부등식을 더하여 결과 부등식을 만듭니다. 다음으로 결과 제약 조건의 계수를 목적 함수와 일치시킵니다.

일단 $(u_1, u_2, u_3, u_4, u_5)=(0, 10, -10, -0, -0)$으로 설정하여 곱하면,

$$
0x_1+0x_2 \le 0 \\
40x_1+100x_2 \le 400 \\
-10x_1 \le -30 \\
-0x_1 \le -0 \\
-0x_2 \le -0
$$

이와 같고 다 더하게 되면 $30x_1+100x_2 \le 370 \rightarrow z^* \le 370$과 같은 결과가 나옵니다. 목적함수에 맞는 $u_i$ 조합은 여러 개 있을 수 있습니다. 각 결합은 상한선입니다.

위와 같이 정해진 값이 아닌 $u_1, ..., u_5$를 부호를 신경써서 곱하도록 해봅시다.

$$
u_1x_1+u_1x_2 \le 7u_1 \\
4u_2x_1+10u_2x_2 \le 40u_2 \\
-u_3x_1 \le -3u_3 \\
-u_4x_1 \le -0 \\
-u_5x_2 \le -0
$$

이제 다 더하면 $(u_1+4u_2-u_3-u_4)x_1 + (u_1+10u_2-u_5)x_2 \le 7u_1+40u_2-3u_3$임을 알 수 있습니다. 각 목적 함수 계수에 따라 제약 조건으로 만들고 $z^*$를 새로 우항 식이 들어가도록 설정하면 아래와 같이 만들어집니다.

$$
min \\
z^* = 7u_1+40u_2-3u_3 \\
s.t \\ 
u_1+4u_2-u_3-u_4 \ge 30 \\
u_1+10u_2-u_5 \ge 100 \\
u_1, u_2, u_3 \ge 0
$$

여기서 $u_4, u_5$는 각 행에만 존재하므로 excess variables라고 합니다. primal problems는 max 솔루션이었지만 dual problems에서는 min으로 변경되었고 제약조건의 우항계수가 dual에서는 목적 함수의 계수로 그리고 primal에서 목적 함수의 계수는 dual에서 제약조건의 우항계수가 되는 등의 변화를 볼 수 있습니다. 그리고 각 제약 변수들의 부호는 primal의 제약 조건의 부호들과 반대가 되고 primal에서 =이었다면 urs로 판단합니다.

---

### weak duality and strong duality

#### weak duality

primal의 일반적인 형태는 아래와 같고,

$$
max \\
z = \sum_{j=1}^{n} c_jx_j \\
s.t \\ 
\sum_{j=1}^{n} a_{i,j}x_j \le b_i \\
x_i \ge 0 (i = 1,...,n)
$$

dual의 일반적인 형태는 아래와 같습니다.

$$
min \\
z^* = \sum_{i=1}^{m} u_ib_i \\
s.t \\ 
\sum_{i=1}^{m} a_{j,i}u_i \ge c_j \\
u_i \ge 0 (i = 1,...,m)
$$

$x_i$ 집합은 primal에서 실행 가능한 영역이고 $u_i$ 집합은 dual에서 실행 가능한 영역입니다. $z$ value for $x$ $\le$ $z^*$ value for $u$가 성립합니다. 예를 들어 primal에서 $(5,2) \rightarrow z:350$와 dual에서 $(0,10,0) \rightarrow z^*:400$으로 증명이 됩니다.

#### strong duality lemma

위와 동일한 primal, dual 형태에서 $z$ value for $x$ $=$ $z^*$ value for $u$가 성립할 때 $x$는 primal에서 최적해이고 $u$는 dual에서 최적해라는 것을 말합니다. 예를 들어 primal에서 $(3,2.8) \rightarrow z:370$와 dual에서 $(0,10,10) \rightarrow z^*:370$으로 동일해지면 최적해가 된다는 것입니다.

BV가 primal의 최적 기저라고 할 때, $u=c_{BV}B^{-1}$ 은 dual의 최적 솔루션입니다. 또한 $z, z^*$는 서로 동일한 값입니다. $c_{BV}$는 초기 목적 함수 계수의 벡터, $B$는 초기 제약 조건에서 $j$번째 열의 행렬을 말합니다.

#### explanation

만약 dual이 무한하다면 $z, z^*$는 무한히 작습니다. 따라서 primal에서 실현 가능하지 않습니다. 반대의 경우도 성립합니다.

#### examples

예를 들어,

$$
max \\
z = 60x_1+30x_2+20x_3+0s_1+0s_2+0s_3
$$

과 같은 LP문제를 풀기 위해 아래에 simplex method tableau와 optimal tableau를 보이겠습니다.

| $z$ | $x_1$ | $x_2$ | $x_3$ | $s_1$ | $s_2$ | $s_3$ | RHS |
|----------|---------|----------|---------|----------|----------|----------|----------|
| 1 | -60 | -30 | -20 | 0 | 0 | 0 | 0 |
| 0 | 8 | 6 | 1 | 1 | 0 | 0 | 48 |
| 0 | 4 | 2 | 1.5 | 0 | 1 | 0 | 20 |
| 0 | 2 | 1.5 | 0.5 | 0 | 0 | 1 | 8 |

| $z$ | $x_1$ | $x_2$ | $x_3$ | $s_1$ | $s_2$ | $s_3$ | RHS |
|----------|---------|----------|---------|----------|----------|----------|----------|
| 1 | 0 | 5 | 0 | 0 | 10 | 10 | 280 |
| 0 | 0 | -2 | 0 | 1 | 2 | -8 | 24 |
| 0 | 0 | -2 | 1 | 0 | 2 | -4 | 8 |
| 0 | 1 | 1.25 | 0 | 0 | -0.5 | 1.5 | 2 |

여기서 BV는 [$s_1, x_3, x_1$]이므로 $c_{BV} = [0, 20, 60]$이 됩니다. 이에 따라 $B$라는 행렬은 $\begin{bmatrix} 1 & 1 & 8 \\ 0 & 1.5 & 4 \\ 0 & 0.5 & 2 \end{bmatrix}$과 같으며 마지막으로 $u=\begin{bmatrix} 0 & 20 & 60 \end{bmatrix} \begin{bmatrix} 1 & 1 & 8 \\ 0 & 1.5 & 4 \\ 0 & 0.5 & 2 \end{bmatrix}=\begin{bmatrix} 0 & 10 & 10 \end{bmatrix}$로 구해질 수 있습니다.

제약 조건 i가 primal에서 $\le$이면 dual에서 $u_i$의 최적 값은 $R_0$의 여유 변수 $s_i$ 계수와 같습니다. 제약 조건 i가 primal에서 $\ge$이면 dual에서 $u_i$의 최적 값은 $R_0$의 초과 변수 $e_i$ 계수와 같습니다. 제약 조건 i가 primal에서 $=$이면 dual에서 $u_i$의 최적 값은 ($R_0$의 인공 변수 $a_i$ 계수 - $M$)과 같습니다.


---

### complementary slackness

primal의 일반적인 형태는 아래와 같고,

$$
max \\
z = \sum_{j=1}^{n} c_jx_j \\
s.t \\ 
\sum_{j=1}^{n} a_{i,j}x_j \le b_i \\
x_i \ge 0 (i = 1,...,n)
$$

dual의 일반적인 형태는 아래와 같습니다.

$$
min \\
z^* = \sum_{i=1}^{m} u_ib_i \\
s.t \\ 
\sum_{i=1}^{m} a_{j,i}u_i \ge c_j \\
u_i \ge 0 (i = 1,...,m)
$$

primal에서 제약조건의 부호가 $\le$이기 때문에 $s_i$를 추가하고 dual에서 제약조건의 부호가 $\ge$이기 때문에 $e_i$를 추가하면 아래와 같이 변경됩니다.

$$
s.t \\ 
\sum_{j=1}^{n} a_{i,j}x_j + s_i \le b_i, i=1,..., m \\
s_i \ge 0 (i = 1,...,m)
$$

$$
s.t \\ 
\sum_{i=1}^{m} a_{j,i}u_i - e_j \ge c_j, j=1,..., n \\
e_j \ge 0 (j=1,..., n)
$$

slackness theorem에서 primal의 각 여유 변수와 dual의 각 결정변수의 곱인 $s_iu_i=0$, 그리고 dual의 각 초과 변수와 primal의 각 결정변수의 곱인 $e_jx_j=0$이 성립합니다.


---

### dual simplex method

위에서 구하는 $u=c_{BV}B^{-1}$을 계산하고 최적의 primal tableau로부터 dual solution을 식별합니다. slackness theorem을 사용하여 각 최적해를 구할 수 있습니다.

dual simplex를 풀이하는 방법으로 가장 부정적인 BV를 leaving variable로 선택하고 pivot합니다. 그 다음 $R_0$의 NBV 계수를 피벗 행의 NBV 계수로 나누고 절대 비율이 가장 작은 변수를 entering variable로 선택합니다. 기본 simplex와 차이점이 바로 leaving variable을 먼저 선택한다는 점입니다. 다음으로 음의 RHS를 갖는 제약조건과 각 변수가 음이 아닌 계수를 갖는 경우 최적 솔루션을 찾을 수 없습니다.

예를 들어,

$$
min \\
z^* = u_1 + 2u_2 \\
s.t \\ 
u_1-2u_2+u_3 \ge 4 \\
2u_1+u_2-u_3 \ge 6 \\
u_i \ge 0 (i = 1,...,3)
$$

이와 같은 dual problem이 있을 때 모든 제약조건은 RHS보다 크며 모든 변수는 0보다 큰 것을 확인합니다. 다음으로 목적 함수에 음수를 취하여 max problem으로 변경하도록 합니다.

$$
max \\
v = -z^* = -u_1 - 2u_2
$$

따라서 $R_0$을 제외한 행에서 만약 초과 변수가 있는 행이라면 -를 곱해서 음수가 되도록 해야 하며 결과적으로 $R_0 : v + u_1+2u_2=0$, $R_1 : -u_1+2u_2-u_3+e_1=-4$, $-2u_1-u_2+u_3+e_2=-6$으로 행을 만들 수 있습니다. 이를 tableau로 나타내면 아래와 같습니다.

| $v$ | $u_1$ | $u_2$ | $u_3$ | $e_1$ | $e_2$ | RHS | BV |
|----------|---------|----------|---------|----------|----------|----------|----------|
| 1 | 1 | 2 | 0 | 0 | 0 | 0 | $v=0$ |
| 0 | -1 | 2 | -1 | 1 | 0 | -4 | $e_1=-4$ |
| 0 | -2 | -1 | 1 | 0 | 1 | -6 | $e_2=-6$ |

여기서 이제 가장 부정적인 BV를 leaving variable로 선택해야 하며 $e_2$가 해당합니다. 피벗 행과 $R_0$ 행의 음수 계수 비율은 1/(-2), 2/(-1)과 같습니다. 이 때 절대값 기준 작은 값인 $u_1$을 entering variable로 선택하여 ERO를 반복합니다.

| $v$ | $u_1$ | $u_2$ | $u_3$ | $e_1$ | $e_2$ | RHS | BV |
|----------|---------|----------|---------|----------|----------|----------|----------|
| 1 | 0 | 3/2 | 1/2 | 0 | 1/2 | -3 | $v=-3$ |
| 0 | 0 | 5/2 | -3/2 | 1 | -1/2 | -1 | $e_1=-1$ |
| 0 | 1 | 1/2 | -1/2 | 0 | -1/2 | 3 | $u_1=-3$ |

하지만 아직 RHS가 음수인 제약 조건이 있으므로 최적화가 되지 않아 다시 반복합니다. BV가 가장 부정적인 $e_1$이 leaving variable이 되며 해당 행이 피벗 행이 됩니다. NBV 비율을 구하면 $\frac{1/2}{-3/2}=-1/3$, $\frac{1/2}{-1/2}=-1$로 절대값 기준 작은 값인 $u_3$가 entering variable이 됩니다.

| $v$ | $u_1$ | $u_2$ | $u_3$ | $e_1$ | $e_2$ | RHS | BV |
|----------|---------|----------|---------|----------|----------|----------|----------|
| 1 | 0 | 7/3 | 0 | 1/3 | 1/3 | -10/3 | $v=-10/3$ |
| 0 | 0 | -5/3 | 1 | -2/3 | 1/3 | 2/3 | $u_3=2/3$ |
| 0 | 1 | -1/3 | 0 | -1/3 | -1/3 | 10/3 | $u_1=10/3$ |

이제 최적화가 완료되어 $z^*=-v=10/3$, $u_1=10/3$, $u_3=2/3$, $u_2=e_1=e_2=0$이 최적해입니다.

따라서 LP문제의 경우 기본 변수의 수가 제약 조건의 수보다 훨씬 적다면 primal과 dual 모두 서로 반대의 방향 문제로 풀이하는 것이 권유된다고 합니다.

---

### 참고 자료

[원본 경로 #1](https://youtu.be/oAPScEPsNqY?si=eSy2Yha30J3liVjV)

[원본 경로 #2](https://youtu.be/lSM_TQehx00?si=PP4FzUGIz30xbaAv)

[원본 경로 #3](https://youtu.be/bPLNyYFLLT4?si=1XKWW1EqlrPQHXJZ)

[원본 경로 #4](https://youtu.be/eS0ZsfYRLn0?si=qjU2nQ7alcCWa05D)

[원본 경로 #5](https://youtu.be/hiEcWZnkguU?si=jkD4DmSCS0PI69wL)


